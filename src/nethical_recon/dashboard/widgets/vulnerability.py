"""
Vulnerability Widgets

Widgets for displaying vulnerability data including charts and tables.
"""

from typing import Any

from .base import BaseWidget


class VulnerabilityChartWidget(BaseWidget):
    """
    Vulnerability chart widget.

    Displays vulnerability statistics as charts (pie, bar, line).
    """

    async def get_data(self) -> dict[str, Any]:
        """Fetch vulnerability chart data."""
        # In real implementation, fetch from database
        return {
            "chart_type": self.config.get("chart_type", "pie"),
            "data": {
                "by_severity": {
                    "critical": 5,
                    "high": 15,
                    "medium": 32,
                    "low": 18,
                },
                "by_status": {
                    "open": 45,
                    "in_progress": 15,
                    "remediated": 10,
                },
                "kev_count": 3,
            },
            "title": self.title,
        }

    def get_schema(self) -> dict[str, Any]:
        """Get widget schema."""
        return {
            "type": "object",
            "properties": {
                "chart_type": {
                    "type": "string",
                    "enum": ["pie", "bar", "line", "donut"],
                    "default": "pie",
                },
                "group_by": {
                    "type": "string",
                    "enum": ["severity", "status", "asset"],
                    "default": "severity",
                },
            },
        }


class VulnerabilityTableWidget(BaseWidget):
    """
    Vulnerability table widget.

    Displays vulnerabilities in tabular format with filtering and sorting.
    """

    async def get_data(self) -> dict[str, Any]:
        """Fetch vulnerability table data."""
        # In real implementation, fetch from database
        return {
            "columns": ["CVE", "Severity", "Asset", "Status", "KEV"],
            "rows": [
                ["CVE-2021-44228", "Critical", "web-server-01", "Open", "Yes"],
                ["CVE-2021-45046", "High", "web-server-01", "Open", "Yes"],
                ["CVE-2022-1234", "Medium", "api-gateway", "In Progress", "No"],
            ],
            "total_count": 70,
            "page": self.config.get("page", 1),
            "per_page": self.config.get("per_page", 10),
        }

    def get_schema(self) -> dict[str, Any]:
        """Get widget schema."""
        return {
            "type": "object",
            "properties": {
                "page": {"type": "integer", "minimum": 1, "default": 1},
                "per_page": {"type": "integer", "minimum": 5, "maximum": 100, "default": 10},
                "filter_severity": {
                    "type": "array",
                    "items": {"type": "string", "enum": ["critical", "high", "medium", "low"]},
                },
                "show_kev_only": {"type": "boolean", "default": False},
            },
        }
